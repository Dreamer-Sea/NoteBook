# 分库分表

[toc]

# 为什么需要分库分表？
1. 性能：大部分关系型数据库使用的是B+树的结构，随着数据的增加，树的深度也会增加，着就会导致磁盘访问的IO次数增加，进而导致查询性能的下降。
2. 可用性：随着数据量的增加，数据库的压力会越来越大，这将影响数据库的可用性。
3. 运维成本：数据的备份和恢复会随着数据量的增加而变得复杂。

# 什么是分库分表？
按照某个维度，对一个大的表或大的库进行分割。

# 数据分片

## 垂直分片
根据业务进行拆分，实现同一业务的表在同一个数据库，不同业务的表在不同的数据库。

**优点**
- 库表职责单一，复杂度降低，易于维护。
- 单库或单表压力降低。相互之间的影响也会降低。

**缺点**
- 部分表关联无法在数据库级别完成，需要在程序中完成。
- 单表大数据量仍然存在性能瓶颈。
- 单表或单库高热点访问依旧对DB压力非常大。
- 事务处理相对更为复杂，需要分布式事务的介入。
- 拆分达到一定程度之后，扩展性会遇到限制。

## 水平分片
通过某个字段或多个字段，根据某种规则将数据分散至多个库或表中，每个分片仅包含数据的一部分。

**优点**
- 解决单表单库大数据量和高热点访问性能遇到瓶颈的问题。
- 应用程序端整体架构改动相对较少。
- 事务处理相对简单。
- 只要切分规则能够定义好，基本上较难遇到扩展性限制。

**缺点**
- 拆分规则相对复杂，很难抽象出一个能够满足整个数据库的切分规则。
- 后期数据的维护难度有所增加，认为手工定位数据更困难。
- 产品逻辑将变复杂。

# 采用分库分表后，有哪些常见问题
1. 需要知道数据在哪个数据库哪个表。
2. 在单数据库上能够正常执行的SQL语句，在这情况下可能出错。
3. **跨库事务**。
4. 需要使用分布式全局唯一ID。