# MySQL数据库
[toc]
# 存储引擎
## MyISAM
老版本的MYSQL的默认存储引擎。不支持数据库事务，行级锁和外键，因此在插入(INSERT)或更新(UPDATE)数据时需要锁定整个表，效率低。
该引擎读取操作块，且占用内存和存储资源较少。

## InnoDB
该引擎为MySQL提供了事务支持，回滚，崩溃修复能力，多版本并发控制和事务安全的操作。底层的数据结构时B+树。
B+树的每个节点都对应InnnoDB的一个Page，Page的大小是固定的，一般被设为16KB。其中，非叶子节点只有键值，叶子节点包含完整的数据。

## MyISAM和InnoDB的对比
1. 是否支持行级锁：后者支持。
2. 是否支持事务和崩溃后的安全恢复：后者支持。
3. 是否支持外键：后者支持。
4. 是否支持MVCC：后者支持。

### 为什么InnoDB的底层数据结构是B+树，而不是B树
- 区别：
	1. B+树的非叶子节点不存放数据，B树的非叶子节点存放数据。
	2. 在B+树，A节点的最后一个子节点会存放指向A节点兄弟节点的第一个子节点的指针。
- B+树这种将数据都存放在叶子节点，而非叶子节点不存放数据的存储方式，能够提高数据库查询的稳定性。
- B+树的每一节点存储的元素更多，使得查询的IO次数更少。
- 所有叶子节点形成了一个有序的链表，更加便于查找(**模糊搜索**，**范围查询**)。

适用的场景：
- 经常有数据更新的表，适合处理多重并发更新请求。
- 支持事务。
- 支持灾难恢复。
- 支持外键约束。
- 支持自动增长列属性。

# 索引
## 聚簇索引 & 非聚簇索引
- 聚簇索引(主键索引)：叶子节点存储有**整行数据**的索引。
- 非聚簇索引(普通索引)：叶子节点存储有**主键值**的索引。

## 覆盖索引
指一个查询语句的执行只用从索引中就能够取得，不必从数据表中读取。也可以称之为实现了索引覆盖。

# 回表
在使用SQL语句进行查询的时候，需要先从普通索引中找到该普通索引，然后才能得到该普通索引的主键索引的过程。
```sql
1. select * from User where id = 3
2. select * from User where uid = 23
```
第二条SQL语句触发了回表操作，因为根据uid字段只能找到值为23的普通索引，而不能得到其它字段的值，所以找到uid=23这个索引后，需要取出其中存储的主键值，然后得到整行数据。

# 索引的最左前缀原则：
在联合索引的情况下，不需要索引的全部定义，只要满足最左前缀，就可以利用索引来加快查询速度。这个最左前缀可以是联合索引的最左 N 个字段，也可以是字符串索引的最左 M 个字符

# 索引下退
MySQL 5.6及之后能够在使用联合索引的前提下，在使用索引遍历的过程中，对索引中包含的其余字段先做判断，直接过滤掉不满足条件的记录，减少回表次数，提升查询效率。

# where，group by和having
- 三者的用途
	- where：用来筛选from子句中指定的操作所产生的行。
	- group by：用来分组where子句的输出。
	- having：用来从分组的结果中筛选行。


# 数据库三范式
## 第一范式
字段必须是不可再分的最小数据单元。
## 第二范式
在第一范式的基础上，表中的非主键列不存在对主键的部分依赖。
## 第三范式
在第二范式的基础上，表中的列不存在对非主键列的传递依赖。

# 日志模块
在MySQL中，每次的更新操作并不是**马上的写磁盘**，而是先将更新操作**写入日志**，并在合适的时候写磁盘。
主要的日志模块有**回滚日志(undo log)**、**重做日志(redo log)**和**归档日志(binlog)**。

## undo log
该日志模块的作用是记录未提交事务的旧值，目的是为了当事务提交失败后，能够实现事务的回滚。即使事务成功持久化到磁盘上，该事务的旧值依旧会在undo log上保存一段时间。

## redo log
该日志是用来记录已经提交的事务，当其中的内容达到一定的程度时，将所有内容一次性写入磁盘。
该日志时固定大小的，如果将redo log配置为一组4个文件，每个文件的大小是1GB，那么redo log总共就可以记录4GB的操作。
redo log保证了数据库发生**异常重启**之后，之前提交的记录不会丢失，这个能力称为**crash-safe**。

## binlog
这个日志模块是**Server层自带**的，是一种**逻辑日志**，记录本次修改的原始逻辑(实际上就是SQL语句)。该日志模块是追加写的形式，可以写多个文件，不会覆盖之前的日志。

该日志主要用于复制和恢复(尤其是主从复制)。

## MVCC
多版本控制。读不加锁，读写不冲突。

# 一条SQL语句执行得很慢得原因有哪些？
## 偶尔很慢
- 脏页刷新：与redo log有关。
- 拿不到锁。
## 一直很慢
- 没有给字段加索引。
- 索引没用上：
	1. 对字段进行函数操作。
	2. 数据库选错了索引。
	3. 数据量较小，查询引擎不使用索引。

# MySQL事务有哪些特性
ACID
- 原子性(Atomicity)：事务中的所有操作要么全部执行，要么全部不执行。
- 一致性(Consistency)：保证数据库状态从一个一致状态转变为另一个一致状态。
- 隔离性(Isolation)：多个事务并发执行时，一个事务的执行不应影响其他事务的执行。
- 持久性(Durability)：一个事务一旦提交，对数据库的修改应该永久保存。

# 数据库的并发操作会产生哪些问题？
- 丢失更新
- 脏读
- 不可重复读
- 幻读

# MySQL数据库的隔离级别有哪些？
- 读未提交
- 读已提交
- 可重复读
- 序列化

# MySQL建表的约束条件
- 主键约束：唯一性，非空性。
- 唯一约束：唯一性，可以为空，但只能有一个。
- 检查约束：对该列数据的范围、格式的限制。
- 默认约束：该数据的默认值。
- 外键约束：需要建立两表间的关系并引用主表的列。


