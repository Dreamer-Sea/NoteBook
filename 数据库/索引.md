# 索引

[toc]

# 唯一索引和普通索引的对比
## 查询
1. 唯一索引：找到该条记录后就返回，因为字段的值是唯一的。
2. 普通索引：扫到最后一个记录才返回结果，因为字段值可能不唯一。

在当前的计算机中，这两种索引的性能没有差别。

因为InnoDB在将数据读入内存时，是按页读入的，每个页能够存储几千个key。所以在查询的时候，这两个索引的性能基本没差。

## 更新
1. 唯一索引：记录在更新后，会写入页中。如果索引所在的页不在内存中，那么就需要将相应的页读入内存。
2. 普通索引：记录在更新后，会写入到**change buffer**中，当索引所在的页读入内存后，才会将更新写入页。

当前IO操作是整个计算机的性能瓶颈，所以IO操作会让两个索引的性能差距很大。

## 总结
普通索引的change buffer优点，只有在写多读少的场景下才显得有意义，因为写完后立马就读，就需要将change buffer的内容写入数据页中。

# 需要扫描行数的错误预估
在一个使用了索引的数据表中，执行查询操作时，MySQL可能会无视索引而选择进行全表扫描，这就会导致SQL语句执行变慢。而这个问题产生的原因是在对数据表进行多次更新操作后，优化器对查询语句需要扫描的记录数的数量的预估就会产生很大的误差。

解决方法就是执行下面这条SQL语句：
```sql
analyze table t
```

也能够使用**force index(a)**强制使用某个索引。
