# 网络
[toc]
# OSI七层模型
- 应用层：该层构建具体应用。**协议：Telnet，FTP，HTTP，DNS**。
- 表示层：该层对数据进行加密，解密，压缩和解压缩等。
- 会话层：在传输层的基础上建立连接和管理会话。
- 传输层：该层定义了传输数据的协议和端口号，主要用于数据的分段，传输和重组。**协议：TCP，UDP**。
- 网络层：该层对数据包中的IP地址进行解析和封装。该层数据被称为数据包。该层设备有：路由器，交换机和防火墙等。
- 数据链路层：该层对数据包中的MAC进行解析和封装。该层的数据被称为帧。在这层工作的设备有：网卡，网桥和交换机等。
- 物理层：定义了物理设备标准。该层的数据被称为比特。

# TCP/IP四层网络模型
TCP/IP协议簇。
- 应用层：负责具体应用层协议的定义。**协议：Telnet，FTP，SMTP，DNS，SMTP，NNTP和HTTP**。
- 传输层：除了基本的数据传输功能，还有可靠性保证，流量控制，多路复用，优先权和安全性控制等功能。
- 网络层：主要用于数据的传输，路由及地址的解析。**协议：IP，ARP**。
- 网络接口层：该层定义了主机间网络连通的协议。**协议：Echernet，FDDI，ATM等通信协议**。

# TCP三次握手
## 滑动窗口
在三次握手的时候，双方会互相将自己的**最大可接收的数据量**告诉对方，也就是自己的**数据接收缓存池**的大小。如果接收缓存池的大小发生变化时，**要给对方发送更新窗口大小的通知**。

# TCP四次挥手
## 2MSL
主动关闭方在收到被动一方发出的FIN信号，会立马发送ACK确认信号，之后状态转变为**TIME_WAIT**，等待2MSL后才会进入**CLOSE**状态。
MSL(Maximum Segment Lifetime)：最大报文生存周期，该周期是任何报文在网络上存在的最长时间，超过这个时间的报文会被丢弃。主动关闭方需要等待2MSL是为了，**防止最后一次ACK没有被正确的传给被动方**，被动关闭方会再次发送第三次的FIN信号。

# TCP和UDP的区别
- TCP协议在数据通信之间需要三次握手建立连接，UDP不需要即发送数据。
- TCP有确认机制，掉包可以重发，保证数据的正确性；UDP不保证正确性，只负责发送数据包。
- TCP可能对大数据包进行拆分，在接收端进行重组数据包操作；UDP是面向报文的，不会进行分片和重组，所以需要注意传输的报文大小。
- 网络包中的TCP头部大小为**20个字节**；UDP头部只有**8个字节**。

# TCP协议如何保证可靠传输
1. 数据分块：应用数据被分割成TCP认为**最合适发送的**数据块。
2. 编号：对每个数据包进行编号，并从发送端**有序的**发送给接收端。
3. 校验和：TCP报文的头部记录有报文的校验和，接收端在接收到传输过来的数据后，会计算校验和，并将计算结果与报文头部中的校验和进行对比。
4. 丢弃重复：TCP接收端会丢弃重复的数据。
5. 流量控制：连接的两端都有**固定大小**的缓冲空间，TCP接收端只允许发送端发送接收端缓冲区能接纳的数据。如果发送端的发送速率太快，能够通过改变滑动窗口的大小来控制发送速率。
6. 拥塞控制：当连接中的数据太多的时候，TCP会控制发送的数据量。
7. ARQ协议：一个分组一个分组的发送数据，当发送端接收到接收端发来的接收确认信息才会发送下一个分组。
8. 超时重传：如果数据发出后，发送端没有接收到确认信息，那么发送端就会重新发送这个数据。

# 什么是ARQ协议
ARQ(Automatic Repeat-reQuest ARQ)是OSI模型中数据链路层和传输层的错误纠正协议之一。通过使用确认和超时这两个机制，在不可靠服务的基础上实现可靠的信息传输。如果发送方在发送一段时间之内没有收到确认帧，它通常会重新发送。ARQ协议包括停止等待ARQ协议和连续ARQ协议。

## 停止等待ARQ协议
- 该协议就是每发完一个分组，需要等待对方确认。如果过一段时间后还没收到对方的确认信息，就说明没有发送成功，需要重新发送，直到收到确认后再发下一个分组。
- 如果接收方收到重复分组，就丢弃该分组，但同时还要发送确认。

## 连续ARQ协议
- 在该协议中，发送方维持一个发送窗口，凡是位于发送窗口内的分组可以连续发送出去，而不需要等待对方确认。接收方采用累计确认的方式，直到按顺序收到最后一个分组为止才一次性发送收到确认信息。
- 该协议能提高信道利用率。

# 拥塞控制
1. 慢开始：一开始发送较少的数据量，然后逐步增加。
2. 拥塞避免：逐步扩大拥塞窗口。
3. 快重传与快恢复：一旦发现消息丢失就马上重传和恢复，减少更多的信息丢失。

# HTTP

## 原理
HTTP是一个无状态协议，无状态指的是客户端和服务端之间不需要建立持久的连接。该协议遵循请求/应答模型，客户端发送请求，服务器端处理请求并返回适当的应答。

## 传输过程
- 地址解析：通过DNS解析服务器的域名从而获得主机的IP地址。
- 封装HTTP数据包：
- 封装TCP包：
- 建立TCP连接：三次握手。
- 客户端发送请求：
- 服务器响应：服务器响应客户端的请求，并返回相应的数据。
- 关闭TCP连接：TCP四次挥手。

# 状态码
- 1XX：信息码。
- 2XX：响应成功。
- 3XX：重定向。
- 4XX：客户端错误。
- 5XX：服务器错误。

# HTTP 1.0、HTTP 1.1 和 HTTP 2.0协议的区别：
## HTTP 1.0
一种无状态、无连接的协议。浏览器的每次请求都需要与服务器建立一个TCP连接，服务器处理完成后**立即断开TCP连接**(无连接)，服务器**不跟踪每个客户端也不记录过去的请求**(无状态)。也就是默认使用Connection: close。
## HTTP 1.1
该协议默认使用Connection: keep-alive，避免了连接建立和释放的开销。但服务器必须按照客户端请求的先后顺序依次放回相应的结果，以保证客户端能够区分出每次请求的响应内容。通过Content-Length字段来判断当前请求的数据是否已经全部接收。不允许同时存在两个并行的响应。
## HTTP 2.0
该协议新增了二进制分帧、多路复用、头部压缩和服务器推送等功能，进一步提高了传输效率。

# HTTPS
在HTTP的基础上加入了SSL层(安全套接字层)，对传输的数据进行了加密。
SSL协议分为：
- 记录协议：接收上层协议或下层协议的信息并进行一系列的处理，然后再将处理后的消息继续向下或向上传递。主要包括对消息进行加解密，压缩解压缩，分段或者重组等操作。
- 握手协议：建立在三次握手之后，为通信双方确立安全连接所需要的安全参数，通常也会在此阶段对通信双方身份的真实性进行验证。
- 警告协议：无论是在握手阶段还是在对应用层数据的传输阶段都有可能出现差错。警告协议规定了在SSL协议工作过程中可能出现的差错、错误的严重等级以及相应的处理方式。
- 密码规范改变协议：在SSL握手刚开始的时候，加密参数还没确定，消息都是明文传送的。双方协商好加密参数之后，在发送握手结束消息之前，需要发送一个密码规范改变消息(Change Cipher Message)来通知对方随后的消息都使用刚刚协商好的加密算法和加密密钥进行加密。

## 加密流程
- 发起请求：建立TCP连接后，客户端向服务器发送请求证书的消息，在该请求消息中包含了客户端可实现的算法列表和其它需要的信息。
- 证书返回：服务器在接收到请求之后，将会响应请求并返回证书。证书中包含服务器信息，域名，申请证书的公司，公钥，数据加密算法等。
- 证书验证：客户端在收到证书后，会检查证书的机构和使用公钥来确认签名。确认证书有效后，客户端会生成对称密钥，并使用公钥对密钥加密。
- 密钥交换：客户端将对称密钥发送给服务器，服务器在收到对称密钥后使用密钥对其解密。
- 数据传输：经过以上步骤后，客户端和服务器端就能够使用对称密钥进行数据传输了。

# Cookie和Session的区别
- Cookie一般用来保存用户信息。
- Session的主要作用就是通过服务端记录用户的状态。

# 内容分发网络(CDN，Content Delivery Network)

## 关键技术
- 内容发布：
- 内容路由：
- 内容交换：
- 性能管理：

## 主要特点
- 本地缓存加速：将客户端经常访问的资源缓存在本地，提高系统的响应速度和稳定性。
- 镜像服务：消除不同运营商之间的网络差异。使得用户在不同的运营商中都有较好的网络体验。
- 远程加速：利用DNS负载均衡技术为用户选择服务质量最优的服务器，加快用户远程访问的速度。
- 带宽优化：自动生成服务器的远程镜像缓存服务器，使得远程用户能够从就近的缓存服务器上读取到数据，减少远程访问。
- 集群抗打击：通过网络安全技术和CDN之间的智能冗余机制，可以有效的减少网络攻击对网站的影响。

## 应用
- 内容分发系统：将用户请求的数据分发到距离用户较近的数个服务器上。
- 负载均衡系统：该系统是CDN的核心。该系统能够根据当前网络的流量分布，各中心机房服务器的复杂和用户请求的特点，将用户的请求负载到不同的中心机房或不同的服务器上，以保障用户内容访问的流畅性。
- 管理系统：该系统对整个CDN网络资源的运行状态进行实时监控和管理。

## 负载均衡算法
- 轮询均衡：将客户端请求轮流分配到1至N台服务器上，每台服务器均被均等地分配一定数量地客户端请求。该算法适合集群中所有服务器都有相同地软硬件配置和服务能力的情况下。
- 权重轮询均衡：该算法根据服务器的权重，轮询地分配客户端地请求。
- 随机均衡：将网络中地请求随机分配给内部的对台服务器。
- 权重随机均衡：类似于权重轮询算法。但是该算法在分配请求时不在轮询发送，而是随机选择某个权重的服务器发送。
- 响应速度均衡：根据负载均衡设备到各个服务器的响应速度的不同，将客户端发送的请求交给响应速度最快的服务器处理。这里的响应速度并不是客户端到服务器，所以存在偏差。
- 最少连接数均衡：负载均衡器内部记录当前每台服务器正在处理的连接数量，在有新的请求的时候，将请求分给给连接数最少的服务器。
- 处理能力均衡：该算法将请求分配给内部负荷最轻的服务器处理。
- DNS响应均衡：该算法使得所有的负载均衡设备都会收到来自客户端的域名解析请求，并且都会解析并返回结果IP，客户端会访问它收到的第一个IP地址。
- 散列算法均衡：使用一致性散列算法和虚拟节点技术将相同参数的请求都发送给同一台服务器。
- IP地址散列：同一客户端的请求总是被同一台服务器处理。
- URL散列：通过管理客户端请求URL信息的散列表，将相同URL的请求转发给同一台服务器。

# 路由汇聚
把一组路由汇聚为一个单个的路由官博。这样能够缩小网络上的路由表的尺寸。

# 子网掩码的求法
要知道子网数目或每个子网内的所需主机数目。
根据划分的子网数：
- 将子网数转为二进制表示；
- 取得二进制的位数，为N；
- 取得该IP地址的类子网掩码，将其主机地址部分的前N位置为1即得出该IP地址划分子网的子网掩码。

利用主机数计算：
- 将主机数目转化为二进制表示；
- 如果主机数小于或等于254(注意去掉保留的两个IP地址)，则取得主机的二进制位数，为N；
- 将该类IP地址的主机地址位数全部置1，然后从后向前的将N位全部置为0，即为子网掩码值。

