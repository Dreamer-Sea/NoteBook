# JUC中的CopyOnWriteArrayList类
[toc]
## 原理
CopyOnWriteArrayList类的加锁实现是ReentrantLock，只有在写操作的时候会加锁，读操作不加锁。该类的底层数据结构是数组。在写操作的时候，该类会先生成一个当前数组的副本，然后对这个副本进行写操作，在写操作完成后，将数组对象指向新的数组。
## 问题
该类在获取元素的时候，是先找到底层数组(步骤A)，然后再根据下标去访问数组中的元素(步骤B)。如果该类在执行完步骤A后，有另外的线程执行了该类的remove操作，就会导致执行步骤B的时候，获得的元素不是预期的。即弱一致性问题。
在使用迭代器的时候，也会产生相同的弱一致性问题。

