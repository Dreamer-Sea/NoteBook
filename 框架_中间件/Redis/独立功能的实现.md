# 独立功能的实现

[toc]

# 发布与订阅
服务器状态在**pubsub_channels字典**里保存了所有频道的订阅关系：**SUBSCRIBE命令**负责将客户端和被订阅的频道关联到这个字典里，而**UNSUBSCRIBE命令**负责解除客户端和被退订频道之间的关联。

服务器状态在**pubsub_patterns链表**保存了所有模式的订阅关系：**PSUBSCRIBE命令**负责将客户端和被订阅的模式记录到这个链表中，而**PUNSUBSCRIBE命令**则负责移除客户端和被退订模式在链表中的记录。

**PUBLISH命令**通过访问**pubsub_channels字典**来向频道的所有订阅者发送消息，通过访问**pubsub_patterns链表**来向所有匹配频道的模式的订阅者发送消息。

**PUBSUB命令**的三个子命令都是通过读取**pubsub_channels字典**和**pubsub_patterns链表**中的信息来实现的。